local Translations = {
    ["Settings"] = "设置",
    ["Games"] = "游戏功能(未完成)",
    ["Red Light，Green Light"] = "木头人",
    ["Auto Stop"] = "自动停止",
    ["Disable Injury"] = "移除受伤状态",
    ["Finsh RLGL"] = "传送到木头人终点",
    ["Dalgona"] = "扣糖饼",
    ["Anti Crack"] = "防止破碎",
    ["Get Lighter"] = "得到免费打火机",
    ["Anti Crack"] = "糖饼防破碎(有时候有效果，有时候没有。)",
    ["Auto Dalgona"] = "自动扣糖饼",
    ["Auto Dalgona V2"] = "自动扣糖饼没用",
    ["AX-SCRIPTS"] = "AG汉化",
    ["Lights Out"] = "熄灯",
    ["Safe Zone"] = "传送到安全点位",
    ["Tug of War"] = "拔河",
    ["Rebal"] = "反叛",
    ["Auto shoot Guards"] = "自动击杀守卫(玩家守卫也可击杀。)",
    ["lnk game|by AlexScriptX"] = "墨水游戏|AG汉化",
    ["Rope Pull Mode"]="拔河方式",
    ["Normal"]="正常",
    ["Pull Rope"]="启用效果",
    ["Manual"]="手动(建议用这个点慢点不容易被发现)",
    ["Troll"]="必输",
    ["Rage"]="狂暴",
    ["Ultra Rage"]="超级狂暴(不推荐使用)",
    ["Perfect"]="完美",
    ["Combat"]="战斗类(未开始制作)",
    ["Miscs"]="杂物项(里面有VIP和各种免费的通行证已翻译这些和一部分其他功能)",
    ["Spectate"]="启用观战",
    ["Gamepasses(NOT FE)"]="免费通行证",
    ["Enable VIP"]="免费会员",
    ["Glass Manufacturer Vision"]="免费玻璃制造者视野",
    ["2x Vote Count"]="2倍投票(没有用后面只要没用的就不翻译了)",
    ["Custom Player Tag(NOT FE)"]="自定义玩家标签",
    ["Security"]="账号保护",
    ["Anti AFK"]="防挂机踢出",
    ["Staff Detector"]="防封(被挂DC了还是会封的)",
    ["Players"]="玩家(未开始汉化)",
    ["Guards"]="守卫(未开始汉化)",
    ["Authentication"]="卡密系统",
    ["Enter Key"]="输入卡密",
    ["Get Key"]="获取卡密",
    ["Check Key"]="检查卡密",

}

local function translateText(text)
    if not text or type(text) ~= "string" then return text end
    if Translations[text] then return Translations[text] end
    local translated = text
    for en, cn in pairs(Translations) do
        translated = translated:gsub(en, cn)
    end
    return translated
end

local translatedElements = {}
local originalTexts = {}

local function safeTranslateElement(element)
    if translatedElements[element] then return end
    
    pcall(function()
        if element:IsA("TextLabel") or element:IsA("TextButton") or element:IsA("TextBox") then
            local currentText = element.Text
            if currentText and currentText ~= "" then
                if not originalTexts[element] then
                    originalTexts[element] = currentText
                end
                
                local translatedText = translateText(currentText)
                if translatedText ~= currentText then
                    element.Text = translatedText
                    translatedElements[element] = true
                end
            end
        end
    end)
end

local function reTranslateAllUI()
    translatedElements = {}
    for _, gui in ipairs(game:GetService("CoreGui"):GetDescendants()) do
        safeTranslateElement(gui)
    end
    local player = game:GetService("Players").LocalPlayer
    if player and player:FindFirstChild("PlayerGui") then
        for _, gui in ipairs(player.PlayerGui:GetDescendants()) do
            safeTranslateElement(gui)
        end
    end
end

local function setupSmartListener()
    local function onTextPropertyChanged(element)
        if translatedElements[element] then
            local currentText = element.Text
            local originalText = originalTexts[element]
            
            if currentText == originalText or translateText(currentText) == currentText then
                translatedElements[element] = nil
                return
            end
            
            local translatedText = translateText(currentText)
            if translatedText ~= currentText then
                element.Text = translatedText
            end
        else
            safeTranslateElement(element)
        end
    end

    local function addSmartListener(parent)
        for _, desc in ipairs(parent:GetDescendants()) do
            safeTranslateElement(desc)
        end
        parent.DescendantAdded:Connect(function(descendant)
            task.wait(0.3)
            safeTranslateElement(descendant)
            
            if descendant:IsA("TextLabel") or descendant:IsA("TextButton") or descendant:IsA("TextBox") then
                descendant:GetPropertyChangedSignal("Text"):Connect(function()
                    task.wait(0.1)
                    onTextPropertyChanged(descendant)
                end)
            end
        end)
    end
    
    pcall(addSmartListener, game:GetService("CoreGui"))
    local player = game:GetService("Players").LocalPlayer
    if player and player:FindFirstChild("PlayerGui") then
        pcall(addSmartListener, player.PlayerGui)
    end
end

local function delayedInitialTranslate()
    task.wait(5)
    reTranslateAllUI()
end

task.wait(2)
setupSmartListener()
delayedInitialTranslate()

local success, err = pcall(function()
    loadstring(game:HttpGet("https://officialaxscripts.vercel.app/scripts/AX-Loader.lua"))()
    task.wait(1.5)
    reTranslateAllUI()
end)

if not success then
    warn("加载失败:", err)
end

